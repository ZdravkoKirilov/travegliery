(self.webpackChunkgoatzilla=self.webpackChunkgoatzilla||[]).push([[640],{1640:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DataSharingModule:()=>ae});var n=i(9171),r=i(665),a=i(8583),s=i(4297),o=i(9645),c=i(2104),l=i(7716),p=i(406),g=i(6226);let h=(()=>{class e{constructor(e){this.projectService=e,this.activeProject$=this.projectService.getActiveProject()}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(p.ProjectsService))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-share-itinerary"]],decls:20,vars:3,consts:[[1,"centered-content","padded-container"],[1,"mb-2","mt-1"],["routerLink","../../../../","cta","tertiary"],[1,"ml-1","mr-1"],["routerLink","../../../","cta","tertiary"],["routerLink","../../","cta","tertiary"]],template:function(e,t){if(1&e&&(l.TgZ(0,"main",0),l._UZ(1,"app-authenticated-header"),l.TgZ(2,"header",1),l.TgZ(3,"span"),l.TgZ(4,"a",2),l._uU(5," Dashboard "),l.qZA(),l.qZA(),l.TgZ(6,"span",3),l._uU(7," / "),l.qZA(),l.TgZ(8,"span"),l.TgZ(9,"a",4),l._uU(10),l.ALo(11,"async"),l.qZA(),l.qZA(),l.TgZ(12,"span",3),l._uU(13," / "),l.qZA(),l.TgZ(14,"span"),l.TgZ(15,"a",5),l._uU(16,"Sharing center"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(17,"article"),l.TgZ(18,"p"),l._uU(19,"Send itinerary information to participants"),l.qZA(),l.qZA(),l.qZA()),2&e){let e;l.xp6(10),l.Oqu(null==(e=l.lcZ(11,1,t.activeProject$))?null:e.name)}},directives:[g.W,n.yS],pipes:[a.Ov],styles:[""],changeDetection:0}),e})(),d=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-itinerary"]],decls:2,vars:0,template:function(e,t){1&e&&(l.TgZ(0,"p"),l._uU(1,"itinerary works!"),l.qZA())},styles:[""]}),e})();var u=i(8002);let m=(e=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let n=63&i[e];t+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return t};var Z=i(6215),f=i(2340);let k=(()=>{class e{constructor(e){this.appRouter=e,this._items$=new Z.X({}),this._emails$=new Z.X({}),this.items$=this._items$.pipe((0,u.U)(e=>{const t=this.appRouter.getProjectId();return Object.values(e).filter(e=>e.projectId===t)})),this.emails$=this._emails$.pipe((0,u.U)(e=>{const t=this.appRouter.getProjectId();return Object.values(e).filter(e=>e.projectId===t)}));const t=JSON.parse(localStorage.getItem("sharedItems")||"{}");this._items$.next(t);const i=JSON.parse(localStorage.getItem("emails")||"{}");this._emails$.next(i)}deleteSharedItem(e){const t=Object.assign({},this._items$.getValue());delete t[e],localStorage.setItem("sharedItems",JSON.stringify(t)),this._items$.next(t)}deleteEmail(e){const t=Object.assign({},this._emails$.getValue());delete t[e],localStorage.setItem("emails",JSON.stringify(t)),this._emails$.next(t)}generatePriceReport(e){const t={id:m(),type:"price-report",emails:[],bookingIds:e,projectId:this.appRouter.getProjectId(),createdAt:(new Date).getTime()};return this._items$.next(Object.assign(Object.assign({},this._items$.getValue()),{[t.id]:t})),localStorage.setItem("sharedItems",JSON.stringify(this._items$.getValue())),t}generateBookingReport(e){const t={id:m(),type:"single-booking",bookingIds:[e],emails:[],projectId:this.appRouter.getProjectId(),createdAt:(new Date).getTime()};return this._items$.next(Object.assign(Object.assign({},this._items$.getValue()),{[t.id]:t})),localStorage.setItem("sharedItems",JSON.stringify(this._items$.getValue())),t}generateEmail(e,t,i){const n=this.appRouter.getProjectId(),r=(new Date).getTime(),a={id:m(),projectId:n,shareId:e,sendAt:i||r,createdAt:r,recipients:t};return this._emails$.next(Object.assign(Object.assign({},this._emails$.getValue()),{[a.id]:a})),localStorage.setItem("emails",JSON.stringify(this._emails$.getValue())),a}getItemLink(e){const t=f.N.currentHost,i=this.appRouter.getProjectId();return"price-report"===e.type?`${t}/projects/${i}/sharing/pricing/${e.id}`:"single-booking"===e.type?`${t}/projects/${i}/sharing/booking/${e.id}`:""}getSharedItem(e){return this._items$.getValue()[e]}}return e.\u0275fac=function(t){return new(t||e)(l.LFG(s.So))},e.\u0275prov=l.Yz7({token:e,factory:e.\u0275fac}),e})();var A=i(2608);let v=(()=>{class e{transform(e){switch(e){case"itinerary":return"Traveler itinerary";case"price-report":return"Price report";case"single-booking":return"Booking";default:return"Unknown"}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=l.Yjl({name:"sharingType",type:e,pure:!0}),e})();var b=i(7920);let y=(()=>{class e{constructor(e){this.datePipe=e}transform(e){const t=new Date,i=new Date(e),n=this.datePipe.transform(e,"short");return(0,b.Z)(t,i)?"Shipped at "+n:"Ships at "+n}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(a.uU,16))},e.\u0275pipe=l.Yjl({name:"emailStatus",type:e,pure:!1}),e})();function T(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",15),l.TgZ(1,"div",16),l.TgZ(2,"a",17),l._uU(3),l.ALo(4,"sharingType"),l.qZA(),l.TgZ(5,"button",18),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(2).deleteItem(t.id)}),l._UZ(6,"svg-icon",19),l.TgZ(7,"span"),l._uU(8,"Revoke"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(9,"div",20),l.TgZ(10,"span",21),l._uU(11,"Created at:"),l.qZA(),l.TgZ(12,"span"),l._uU(13),l.ALo(14,"date"),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit,i=l.oxw(2);l.xp6(2),l.Q6J("href",i.getItemLink(e),l.LSH)("id",e.id),l.xp6(1),l.Oqu(l.lcZ(4,4,e.type)),l.xp6(10),l.Oqu(l.xi3(14,6,e.createdAt,"short"))}}function q(e,t){if(1&e&&(l.TgZ(0,"div"),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.xp6(1),l.hij(" ",e," ")}}function _(e,t){if(1&e){const e=l.EpF();l.ynx(0),l.TgZ(1,"div",16),l.TgZ(2,"a",24),l._uU(3),l.ALo(4,"sharingType"),l.qZA(),l.TgZ(5,"button",18),l.NdJ("click",function(){l.CHM(e);const t=l.oxw().$implicit;return l.oxw(2).deleteEmail(t.id)}),l._UZ(6,"svg-icon",19),l.TgZ(7,"span"),l._uU(8,"Delete"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(9,"span",25),l._uU(10),l.ALo(11,"emailStatus"),l.qZA(),l.TgZ(12,"div",25),l.YNc(13,q,2,1,"div",26),l.qZA(),l.BQk()}if(2&e){const e=t.ngIf,i=l.oxw().$implicit,n=l.oxw(2);l.xp6(2),l.Q6J("href",n.getItemLink(e),l.LSH),l.xp6(1),l.Oqu(l.lcZ(4,4,e.type)),l.xp6(7),l.hij(" ",l.lcZ(11,6,i.sendAt)," "),l.xp6(3),l.Q6J("ngForOf",i.recipients)}}function x(e,t){if(1&e&&(l.TgZ(0,"div",22),l.YNc(1,_,14,8,"ng-container",23),l.ALo(2,"async"),l.qZA()),2&e){const e=t.$implicit,i=l.oxw(2);l.xp6(1),l.Q6J("ngIf",l.lcZ(2,1,i.getItemById(e.shareId)))}}function S(e,t){if(1&e&&(l.TgZ(0,"main",1),l._UZ(1,"app-authenticated-header"),l.TgZ(2,"header",2),l.TgZ(3,"span"),l.TgZ(4,"a",3),l._uU(5," Dashboard "),l.qZA(),l.qZA(),l.TgZ(6,"span",4),l._uU(7," / "),l.qZA(),l.TgZ(8,"span"),l.TgZ(9,"a",5),l._uU(10),l.qZA(),l.qZA(),l.TgZ(11,"span",4),l._uU(12," / "),l.qZA(),l.TgZ(13,"h1",6),l._uU(14,"Sharing center"),l.qZA(),l.qZA(),l.TgZ(15,"article",7),l.TgZ(16,"section",8),l.TgZ(17,"h2",9),l._UZ(18,"svg-icon",10),l.TgZ(19,"span"),l._uU(20,"Links"),l.qZA(),l.qZA(),l.YNc(21,T,15,9,"div",11),l.ALo(22,"async"),l.qZA(),l.TgZ(23,"section",12),l.TgZ(24,"h2",9),l._UZ(25,"svg-icon",13),l.TgZ(26,"span"),l._uU(27,"Emails"),l.qZA(),l.qZA(),l.YNc(28,x,3,3,"div",14),l.ALo(29,"async"),l.qZA(),l.qZA(),l.qZA()),2&e){const e=t.ngIf,i=l.oxw();l.xp6(10),l.Oqu(e.name),l.xp6(11),l.Q6J("ngForOf",l.lcZ(22,3,i.items$)),l.xp6(7),l.Q6J("ngForOf",l.lcZ(29,5,i.emails$))}}let I=(()=>{class e{constructor(e,t,i){this.projectService=e,this.sharingService=t,this.snackbar=i,this.activeProject$=this.projectService.getActiveProject(),this.items$=this.sharingService.items$,this.emails$=this.sharingService.emails$}getItemLink(e){return this.sharingService.getItemLink(e)}getItemById(e){return this.items$.pipe((0,u.U)(t=>t.find(t=>t.id===e)))}deleteItem(e){this.sharingService.deleteSharedItem(e),this.snackbar.open("Link deleted","",{duration:3e3})}deleteEmail(e){this.sharingService.deleteEmail(e),this.snackbar.open("Email deleted","",{duration:3e3})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(p.ProjectsService),l.Y36(k),l.Y36(s.ux))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-sharing-dashboard"]],decls:2,vars:3,consts:[["class","centered-content padded-container",4,"ngIf"],[1,"centered-content","padded-container"],[1,"mb-3","mt-1","flex","wrap","align-center"],["routerLink","../../","cta","tertiary"],[1,"ml-1","mr-1"],["routerLink","../","cta","tertiary"],[1,"h5"],[1,"flex","wrap","mobile-ml-2","mobile-mr-1"],[1,"width-5","mbl-width-12","mr-4","mobile-mr-0"],[1,"mb-2","h4","flex","align-center"],["key","link",1,"mr-2"],["class","mb-3 flex column card",4,"ngFor","ngForOf"],[1,"width-5","mbl-width-12"],["key","email",1,"mr-2"],["class","mb-1 flex column card",4,"ngFor","ngForOf"],[1,"mb-3","flex","column","card"],[1,"flex","align-center","wrap","mb-2"],["target","_blank",1,"mr-3",3,"href","id"],["cta","outlined","secondary","",1,"flex","align-center","justify-center",3,"click"],["key","remove",1,"mr-1"],[1,"small-text","mb-1"],[1,"mr-1"],[1,"mb-1","flex","column","card"],[4,"ngIf"],["target","_blank",1,"mr-3",3,"href"],[1,"small-text"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(l.YNc(0,S,30,7,"main",0),l.ALo(1,"async")),2&e&&l.Q6J("ngIf",l.lcZ(1,1,t.activeProject$))},directives:[a.O5,g.W,n.yS,A.bk,a.sg],pipes:[a.Ov,v,a.uU,y],styles:[""],changeDetection:0}),e})();var U=i(5917),w=i(7057),$=i(4762),O=i(9112),j=i(4785),L=i(800),P=i(2458);function C(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"button",8),l.NdJ("click",function(){return l.CHM(e),l.oxw().makeLink.emit()}),l._UZ(1,"svg-icon",9),l.TgZ(2,"span"),l._uU(3,"Generate link"),l.qZA(),l.qZA()}}function J(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"button",10),l.NdJ("click",function(){return l.CHM(e),l.oxw().onCopy()}),l._UZ(1,"svg-icon",9),l.TgZ(2,"span"),l._uU(3,"Copy link"),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();l.Q6J("cdkCopyToClipboard",e.link)}}function M(e,t){if(1&e&&(l.TgZ(0,"mat-option",22),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e," ")}}function F(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",23),l.TgZ(1,"span",24),l._uU(2),l.qZA(),l.TgZ(3,"button",25),l.NdJ("click",function(t){const i=l.CHM(e).$implicit;return l.oxw(2).removeRecipient(t,i)}),l._UZ(4,"svg-icon",26),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit;l.xp6(2),l.Oqu(e)}}function Y(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",11),l.TgZ(1,"div",0),l.TgZ(2,"input",12,13),l.NdJ("keyup.enter",function(){l.CHM(e);const t=l.MAs(3),i=l.oxw();return i.handleEnter(i.emailFilter),t.focus()})("ngModelChange",function(t){return l.CHM(e),l.oxw().emailFilter=t}),l.qZA(),l.TgZ(4,"mat-autocomplete",14,15),l.NdJ("optionSelected",function(t){return l.CHM(e),l.oxw().addRecipient(t.option.value)}),l.YNc(6,M,2,2,"mat-option",16),l.ALo(7,"async"),l.qZA(),l.TgZ(8,"div",17),l.YNc(9,F,5,1,"div",18),l.qZA(),l._UZ(10,"div",19),l.TgZ(11,"div",20),l.TgZ(12,"button",21),l.NdJ("click",function(){l.CHM(e);const t=l.oxw();return t.handleShare(t.displayedRecipients)}),l._uU(13," Done "),l.qZA(),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.MAs(5),t=l.oxw();l.xp6(2),l.Q6J("ngModel",t.emailFilter)("matAutocomplete",e),l.xp6(4),l.Q6J("ngForOf",l.lcZ(7,4,t.recipients$)),l.xp6(3),l.Q6J("ngForOf",t.displayedRecipients)}}class E{constructor(e){this.snackbar=e,this.makeLink=new l.vpe,this.shareLink=new l.vpe,this.link="",this.emails=[],this.emailFilter$=new Z.X(""),this.showEmailSharing=!1,this._recipients$=new Z.X([]),this.recipients$=(0,O.aj)([this._recipients$,this.emailFilter$]).pipe((0,u.U)(([e,t])=>t?e.filter(e=>e&&e.toLowerCase().includes(t.toLowerCase())&&!this.displayedRecipients.includes(e)):[])),this.displayedRecipients=[],this.emailFilter=""}handleShare(e){this.shareLink.emit(e),this.showEmailSharing=!1}handleEnter(e){e&&(this.displayedRecipients=Array.from(new Set([...this.displayedRecipients,e])),this.emailFilter="")}removeRecipient(e,t){e.stopPropagation(),this.displayedRecipients=this.displayedRecipients.filter(e=>e!==t)}addRecipient(e){e&&(this.displayedRecipients.push(e),this.emailFilter="")}toggleEmailSharing(){this.showEmailSharing=!this.showEmailSharing}onCopy(){this.snackbar.open("Share link was copied!","",{duration:3e3})}ngOnInit(){this._recipients$.next(this.emails)}}E.\u0275fac=function(e){return new(e||E)(l.Y36(s.ux))},E.\u0275cmp=l.Xpm({type:E,selectors:[["app-share-settings"]],inputs:{link:"link",emails:"emails"},outputs:{makeLink:"makeLink",shareLink:"shareLink"},decls:10,vars:3,consts:[[1,"flex","wrap"],[1,"mr-3"],["cta","outlined","class","flex align-center justify-center mobile-mb-2",3,"click",4,"ngIf"],["cta","outlined","class","flex align-center justify-center mobile-mb-2",3,"cdkCopyToClipboard","click",4,"ngIf"],[1,"email-share"],["cta","outlined",1,"flex","align-center","justify-center",3,"click"],["key","share",1,"mr-1"],["class","email-share-toggable",4,"ngIf"],["cta","outlined",1,"flex","align-center","justify-center","mobile-mb-2",3,"click"],["key","link",1,"mr-1"],["cta","outlined",1,"flex","align-center","justify-center","mobile-mb-2",3,"cdkCopyToClipboard","click"],[1,"email-share-toggable"],["type","text","placeholder","Search recipients",1,"input",3,"ngModel","matAutocomplete","keyup.enter","ngModelChange"],["input",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"mt-2"],["class","flex align-center",4,"ngFor","ngForOf"],[1,"separator","mt-3"],[1,"mt-4"],["cta","outlined","secondary","",3,"click"],[3,"value"],[1,"flex","align-center"],[1,"mr-1"],[1,"ghost-button","remove-recipient",3,"click"],["key","remove"]],template:function(e,t){1&e&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l.YNc(2,C,4,0,"button",2),l.YNc(3,J,4,1,"button",3),l.qZA(),l.TgZ(4,"div",4),l.TgZ(5,"button",5),l.NdJ("click",function(){return t.toggleEmailSharing()}),l._UZ(6,"svg-icon",6),l.TgZ(7,"span"),l._uU(8,"Share with"),l.qZA(),l.qZA(),l.YNc(9,Y,14,6,"div",7),l.qZA(),l.qZA()),2&e&&(l.xp6(2),l.Q6J("ngIf",!t.link),l.xp6(1),l.Q6J("ngIf",t.link),l.xp6(6),l.Q6J("ngIf",t.showEmailSharing))},directives:[a.O5,A.bk,j.i3,r.Fj,L.ZL,r.JJ,r.On,L.XC,a.sg,P.ey],pipes:[a.Ov],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .email-share[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:relative}[_nghost-%COMP%]   .email-share-toggable[_ngcontent-%COMP%]{position:absolute;top:50px;background-color:#fff;min-width:300px;padding:var(--space-3);box-shadow:0 4px 8px 0 #0003}@media (max-width:48em){[_nghost-%COMP%]   .email-share-toggable[_ngcontent-%COMP%]{min-width:100%}}[_nghost-%COMP%]   .clear-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .remove-recipient[_ngcontent-%COMP%]{color:var(--secondary-color)}"]}),(0,$.gn)([(0,s.GU)((e,t)=>{!1===e&&(t.emailFilter="",t.displayedRecipients=[])})],E.prototype,"showEmailSharing",void 0),(0,$.gn)([(0,s.GU)((e,t)=>{t.emailFilter$.next(e)})],E.prototype,"emailFilter",void 0);let N=(()=>{class e{constructor(){this.participants=[]}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-booking-visualization"]],inputs:{booking:"booking",participants:"participants"},decls:4,vars:1,template:function(e,t){1&e&&(l.TgZ(0,"p"),l._uU(1,"booking-visualization works!"),l.qZA(),l.TgZ(2,"div"),l._uU(3),l.qZA()),2&e&&(l.xp6(3),l.hij(" ",null==t.booking?null:t.booking.provider,"\n"))},styles:[""],changeDetection:0}),e})();const R=function(){return[]};function Q(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"article"),l.TgZ(1,"app-share-settings",7),l.NdJ("makeLink",function(){const t=l.CHM(e).ngIf;return l.oxw().handleSave(t)})("shareLink",function(t){const i=l.CHM(e).ngIf;return l.oxw().handleShare(t,i)}),l.ALo(2,"async"),l.qZA(),l._UZ(3,"app-booking-visualization",8),l.ALo(4,"async"),l.ALo(5,"async"),l.qZA()}if(2&e){const e=l.oxw();l.xp6(1),l.Q6J("link",e.link)("emails",l.lcZ(2,4,e.participantEmails$)||l.DdM(10,R)),l.xp6(2),l.Q6J("booking",l.lcZ(4,6,e.booking$)||void 0)("participants",l.lcZ(5,8,e.participants$)||l.DdM(11,R))}}let D=(()=>{class e{constructor(e,t,i,n){this.projectService=e,this.projectDataService=t,this.sharingService=i,this.snackbar=n,this.participantEmails$=(0,U.of)([]),this.participants$=(0,U.of)([]),this.link="",this.item=void 0,this.activeProject$=this.projectService.getActiveProject(),this.booking$=this.projectDataService.getActiveBooking(),this.participants$=this.projectDataService.getParticipants(),this.participantEmails$=this.booking$.pipe((0,w.M)(this.projectDataService.getParticipants()),(0,u.U)(([e,t])=>t.filter(t=>e.participants.includes(t.id)).map(e=>e.email)))}handleSave(e){const t=this.sharingService.generateBookingReport(e.id);this.item=t,this.link=this.sharingService.getItemLink(t)}handleShare(e,t){if(!this.item){const e=this.sharingService.generateBookingReport(t.id);this.link=this.sharingService.getItemLink(e),this.item=e}this.sharingService.generateEmail(this.item.id,e),this.snackbar.open("Email sent!","",{duration:3e3})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(p.ProjectsService),l.Y36(p.ProjectDataService),l.Y36(k),l.Y36(s.ux))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-share-booking"]],decls:19,vars:6,consts:[[1,"centered-content","padded-container"],[1,"mb-2","mt-1"],["routerLink","../../../../","cta","tertiary"],[1,"ml-1","mr-1"],["routerLink","../../../","cta","tertiary"],["routerLink","../../","cta","tertiary"],[4,"ngIf"],[1,"block","mb-3",3,"link","emails","makeLink","shareLink"],[3,"booking","participants"]],template:function(e,t){if(1&e&&(l.TgZ(0,"main",0),l._UZ(1,"app-authenticated-header"),l.TgZ(2,"header",1),l.TgZ(3,"span"),l.TgZ(4,"a",2),l._uU(5," Dashboard "),l.qZA(),l.qZA(),l.TgZ(6,"span",3),l._uU(7," / "),l.qZA(),l.TgZ(8,"span"),l.TgZ(9,"a",4),l._uU(10),l.ALo(11,"async"),l.qZA(),l.qZA(),l.TgZ(12,"span",3),l._uU(13," / "),l.qZA(),l.TgZ(14,"span"),l.TgZ(15,"a",5),l._uU(16,"Sharing center"),l.qZA(),l.qZA(),l.qZA(),l.YNc(17,Q,6,12,"article",6),l.ALo(18,"async"),l.qZA()),2&e){let e;l.xp6(10),l.Oqu(null==(e=l.lcZ(11,2,t.activeProject$))?null:e.name),l.xp6(7),l.Q6J("ngIf",l.lcZ(18,4,t.booking$))}},directives:[g.W,n.yS,a.O5,E,N],pipes:[a.Ov],styles:[""]}),e})();const B=function(e){return["../../..","itinerary",e]};function H(e,t){if(1&e&&(l.TgZ(0,"tr"),l.TgZ(1,"td"),l.TgZ(2,"a",3),l._uU(3),l.qZA(),l.qZA(),l.TgZ(4,"td",4),l._uU(5),l.ALo(6,"currency"),l.qZA(),l.TgZ(7,"td",4),l._uU(8),l.qZA(),l.TgZ(9,"td",4),l._uU(10),l.ALo(11,"currency"),l.qZA(),l.qZA()),2&e){const e=t.$implicit,i=l.oxw();l.xp6(2),l.Q6J("routerLink",l.VKq(12,B,e.id)),l.xp6(1),l.AsE("",e.provider," / ",e.confirmationNumber,""),l.xp6(2),l.hij(" ",l.xi3(6,6,e.price,e.currencyCode)," "),l.xp6(3),l.Oqu(e.participants.length),l.xp6(2),l.hij(" ",l.xi3(11,9,i.getBookingTotal(e),e.currencyCode)," ")}}let X=(()=>{class e{constructor(){this.bookings=[]}getBookingTotal(e){return(e.participants.length*e.price).toFixed(2)}getAllBookingsTotal(e){return e.reduce((e,t)=>e+t.participants.length*t.price,0).toFixed(2)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-price-report-visualization"]],inputs:{bookings:"bookings"},decls:19,vars:5,consts:[[1,"mb-4","table"],[4,"ngFor","ngForOf"],[1,"bold","mr-2"],["cta","tertiary",3,"routerLink"],[1,"centered"]],template:function(e,t){1&e&&(l.TgZ(0,"table",0),l.TgZ(1,"thead"),l.TgZ(2,"tr"),l.TgZ(3,"th"),l._uU(4,"Booking"),l.qZA(),l.TgZ(5,"th"),l._uU(6,"Price"),l.qZA(),l.TgZ(7,"th"),l._uU(8,"Quantity"),l.qZA(),l.TgZ(9,"th"),l._uU(10,"Total"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(11,"tbody"),l.YNc(12,H,12,14,"tr",1),l.qZA(),l.qZA(),l.TgZ(13,"div"),l.TgZ(14,"span",2),l._uU(15,"Total: "),l.qZA(),l.TgZ(16,"span"),l._uU(17),l.ALo(18,"currency"),l.qZA(),l.qZA()),2&e&&(l.xp6(12),l.Q6J("ngForOf",t.bookings),l.xp6(5),l.Oqu(l.xi3(18,2,t.getAllBookingsTotal(t.bookings),null==t.bookings[0]?null:t.bookings[0].currencyCode)))},directives:[a.sg,n.yS],pipes:[a.H9],styles:[".table[_ngcontent-%COMP%]{table-layout:auto;width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border:1px solid var(--secondary-color)}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:var(--space-1)}.table[_ngcontent-%COMP%]   .centered[_ngcontent-%COMP%]{text-align:center}"]}),e})();const z=function(){return[]};function V(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"main",1),l._UZ(1,"app-authenticated-header"),l.TgZ(2,"header",2),l.TgZ(3,"span"),l.TgZ(4,"a",3),l._uU(5," Dashboard "),l.qZA(),l.qZA(),l.TgZ(6,"span",4),l._uU(7," / "),l.qZA(),l.TgZ(8,"span"),l.TgZ(9,"a",5),l._uU(10),l.ALo(11,"async"),l.qZA(),l.qZA(),l.TgZ(12,"span",4),l._uU(13," / "),l.qZA(),l.TgZ(14,"span"),l.TgZ(15,"a",6),l._uU(16,"Sharing center"),l.qZA(),l.qZA(),l.TgZ(17,"span",4),l._uU(18," / "),l.qZA(),l.TgZ(19,"h1",7),l._uU(20,"Price report"),l.qZA(),l.qZA(),l.TgZ(21,"article",8),l.TgZ(22,"app-share-settings",9),l.NdJ("makeLink",function(){const t=l.CHM(e).ngIf;return l.oxw().handleSave(t)})("shareLink",function(t){const i=l.CHM(e).ngIf;return l.oxw().handleShare(t,i)}),l.ALo(23,"async"),l.qZA(),l._UZ(24,"app-price-report-visualization",10),l.qZA(),l.qZA()}if(2&e){const e=t.ngIf,i=l.oxw();let n;l.xp6(10),l.Oqu(null==(n=l.lcZ(11,4,i.activeProject$))?null:n.name),l.xp6(12),l.Q6J("link",i.link)("emails",l.lcZ(23,6,i.participantEmails$)||l.DdM(8,z)),l.xp6(2),l.Q6J("bookings",e)}}let G=(()=>{class e{constructor(e,t,i,n){this.projectService=e,this.dataService=t,this.sharingService=i,this.snackbar=n,this.bookings$=(0,U.of)([]),this.participantEmails$=(0,U.of)([]),this.link="",this.item=void 0,this.activeProject$=this.projectService.getActiveProject(),this.bookings$=this.dataService.getFilteredBookings().pipe((0,u.U)(this.dataService.sortBookings)),this.participantEmails$=this.dataService.getFilteredBookings().pipe((0,w.M)(this.dataService.getParticipants()),(0,u.U)(([e,t])=>{const i=Array.from(new Set(e.reduce((e,t)=>[...e,...t.participants],[])));return t.filter(e=>i.includes(e.id)).map(e=>e.email)}))}handleSave(e){const t=this.sharingService.generatePriceReport(e.map(e=>e.id));this.item=t,this.link=this.sharingService.getItemLink(t)}handleShare(e,t){if(!this.item){const e=this.sharingService.generatePriceReport(t.map(e=>e.id));this.link=this.sharingService.getItemLink(e),this.item=e}this.sharingService.generateEmail(this.item.id,e),this.snackbar.open("Email sent!","",{duration:3e3})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(p.ProjectsService),l.Y36(p.ProjectDataService),l.Y36(k),l.Y36(s.ux))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-share-price-report"]],decls:2,vars:3,consts:[["class","centered-content padded-container",4,"ngIf"],[1,"centered-content","padded-container"],[1,"mb-2","mt-1","flex","align-center","wrap","mobile-ml-1","mobile-mr-1"],["routerLink","../../../../","cta","tertiary"],[1,"ml-1","mr-1"],["routerLink","../../../","cta","tertiary"],["routerLink","../../","cta","tertiary"],[1,"h5"],[1,"mobile-ml-1","mobile-mr-1"],[1,"block","mb-3",3,"link","emails","makeLink","shareLink"],[3,"bookings"]],template:function(e,t){1&e&&(l.YNc(0,V,25,9,"main",0),l.ALo(1,"async")),2&e&&l.Q6J("ngIf",l.lcZ(1,1,t.bookings$))},directives:[a.O5,g.W,n.yS,E,X],pipes:[a.Ov],styles:[""]}),e})();var W=i(8513);function K(e,t){if(1&e&&(l.TgZ(0,"header",4),l.TgZ(1,"h1",5),l._uU(2,"Price report"),l.qZA(),l.TgZ(3,"span"),l._uU(4),l.ALo(5,"date"),l.qZA(),l.qZA()),2&e){const e=l.oxw(2);l.xp6(4),l.hij("Created at: ",l.lcZ(5,1,e.sharedItem.createdAt),"")}}function ee(e,t){if(1&e&&(l.TgZ(0,"main",1),l._UZ(1,"app-public-header"),l.YNc(2,K,6,3,"header",2),l._UZ(3,"app-price-report-visualization",3),l.qZA()),2&e){const e=t.ngIf,i=l.oxw();l.xp6(2),l.Q6J("ngIf",i.sharedItem),l.xp6(1),l.Q6J("bookings",e)}}let te=(()=>{class e{constructor(e,t,i){this.dataService=e,this.sharingService=t,this.appRouter=i,this.bookings$=(0,U.of)([]),this.bookings$=this.dataService.getBookings().pipe((0,u.U)(e=>{const t=this.appRouter.getShareId(),i=this.sharingService.getSharedItem(t);return this.sharedItem=i,e.filter(e=>i.bookingIds.includes(e.id))}))}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(p.ProjectDataService),l.Y36(k),l.Y36(s.So))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-price-report"]],decls:2,vars:3,consts:[["class","centered-content padded-container",4,"ngIf"],[1,"centered-content","padded-container"],["class","mb-3 mt-3 mobile-ml-1 mobile-mr-1",4,"ngIf"],[1,"mobile-ml-1","mobile-mr-1","block",3,"bookings"],[1,"mb-3","mt-3","mobile-ml-1","mobile-mr-1"],[1,"h3"]],template:function(e,t){1&e&&(l.YNc(0,ee,4,2,"main",0),l.ALo(1,"async")),2&e&&l.Q6J("ngIf",l.lcZ(1,1,t.bookings$))},directives:[a.O5,W.E,X],pipes:[a.Ov,a.uU],styles:[""]}),e})();function ie(e,t){if(1&e&&(l.TgZ(0,"header",4),l.TgZ(1,"h1",5),l._uU(2,"Booking summary"),l.qZA(),l.TgZ(3,"span"),l._uU(4),l.ALo(5,"date"),l.qZA(),l.qZA()),2&e){const e=l.oxw(2);l.xp6(4),l.hij("Created at: ",l.lcZ(5,1,e.sharedItem.createdAt),"")}}function ne(e,t){if(1&e&&(l.TgZ(0,"main",1),l._UZ(1,"app-public-header"),l.YNc(2,ie,6,3,"header",2),l._UZ(3,"app-booking-visualization",3),l.qZA()),2&e){const e=t.ngIf,i=l.oxw();l.xp6(2),l.Q6J("ngIf",i.sharedItem),l.xp6(1),l.Q6J("booking",e)}}const re=[{path:"",component:I,canActivate:[o.WithAuthGuard]},{path:"itinerary/send",component:h,canActivate:[o.WithAuthGuard]},{path:"itinerary/view/:token",component:d},{path:"booking/send/:bookingId",component:D,canActivate:[o.WithAuthGuard]},{path:"booking/:shareId",component:(()=>{class e{constructor(e,t,i){this.appRouter=e,this.sharingService=t,this.projectDataService=i;const n=this.appRouter.getShareId();this.sharedItem=this.sharingService.getSharedItem(n),this.booking$=this.projectDataService.getBookingById(this.sharedItem.bookingIds[0])}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(s.So),l.Y36(k),l.Y36(p.ProjectDataService))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-booking"]],decls:2,vars:3,consts:[["class","centered-content padded-container",4,"ngIf"],[1,"centered-content","padded-container"],["class","mb-3 mt-3 mobile-ml-1 mobile-mr-1",4,"ngIf"],[3,"booking"],[1,"mb-3","mt-3","mobile-ml-1","mobile-mr-1"],[1,"h3"]],template:function(e,t){1&e&&(l.YNc(0,ne,4,2,"main",0),l.ALo(1,"async")),2&e&&l.Q6J("ngIf",l.lcZ(1,1,t.booking$))},directives:[a.O5,W.E,N],pipes:[a.Ov,a.uU],styles:[""]}),e})()},{path:"pricing/send",component:G,canActivate:[o.WithAuthGuard]},{path:"pricing/:shareId",component:te},{path:"**",redirectTo:""}];let ae=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=l.oAB({type:e}),e.\u0275inj=l.cJS({providers:[k,a.uU],imports:[[s.m8,n.Bz.forChild(re),c.p,r.u5],n.Bz]}),e})()}}]);